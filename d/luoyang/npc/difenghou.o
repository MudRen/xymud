// 封喉一剑剑狄风後 Difenghou.c
// Cracked by 凌惊雪 1-17-2003

#include <ansi.h>
inherit NPC;
inherit F_MASTER;
int ask_killer();
string ask_join();
string ask_cancel();
void create()
{
       	set_name("狄风後", ({"di fenghou", "di", "fenghou"}));
       	set("long", 
HIG"封喉一剑剑狄风後，神秘杀手，一剑封喉。\n"NOR);
       	set("title", HIR"封喉一剑"NOR);
       	set("gender", "女性");
       	set("age", 33);
       	set("attitude", "friendly");
       	set("cor", 30);
       	set("per", 30);
       	set("max_kee", 4500);
       	set("max_gin", 800);
       	set("max_sen", 4500);
       	set("force", 4000);
       	set("max_force", 2000);
       	set("force_factor", 125);
       	set("max_mana", 2000);
       	set("mana", 4000);
       	set("mana_factor", 100);
       	set("combat_exp", 2000000);
       	set_skill("literate", 180);
       	set_skill("unarmed", 250);
       	set_skill("dodge", 250);
       	set_skill("force", 300);
       	set_skill("parry", 250);
   	set_skill("xuehejue", 500);
   	map_skill("parry", "xuehejue");
   set("inquiry", ([
          "杀手": (: ask_killer :),
          "出动": (: ask_killer :),
          "killer": (: ask_killer :),
          "加入": (: ask_join :),
          "join": (: ask_join :),
          "失手": (: ask_cancel :),
          
]));
set("chat_chance_combat", 90);
set("chat_msg_combat", ({
(: perform_action,"unarmed", "shipo" :),
 }) );
setup();
}
int ask_killer()
{
    	object who=this_player();
    	object ob=this_object();
    	int i = (int)who->query("jobmark/killerjob", 1);
	int j = (int)who->query("daemon/xuehejue",1);
    	if (who->query("killerside")=="killer")
    	{
	if ( who->query("combat_exp") < 300000 )
	{
	message_vision("$N对$n悄悄说道："+RANK_D->query_respect(who)+"实战经验不足，这危险的差使，别去丢了我们的脸。\n",this_object(),who);
	return 1;
	}
	if ( i/10 > j)
	{
      	message_vision("$N对$n说道：“"+RANK_D->query_respect(who)+"已经完成不少任务，该去研读研读提高你的功夫了。\n",this_object(),who);
      	return 1;
      	}
      	message_vision("$N对$n悄悄说道：“既然"+RANK_D->query_respect(who)+"愿意出手，"+RANK_D->query_self(ob)+"那就给你个任务，看你有没有胆量。\n",this_object(),who);
      	message_vision("$N对$n悄悄说道："+"/d/obj/killer/kill"->query_killer(who),this_object(),who);
      	return 1;
	}
	message_vision("$N大怒道：你是消遣本座来着？\n",this_object(),who);
	return 1;
}
void init()
{
        add_action("do_agree", "agree");
}

string ask_join()
{
	object me=this_player();
	if (!me->query("killerside")) {
		me->set_temp("killerside", 1);
		return ("入得我楼，须终生为我金衣楼效力，你可愿意(agree)？");
	}
	return ("在下不知。\n");
}
string ask_cancel()
{
    	object me=this_player();
	if((int)me->query("mykiller"))
{
      	me->add("combat_exp",-1000);
      	me->add("xyscore",-1);
      	me->add("jobmark/killerjob",-1);
      	me->delete("mykiller");
     	return ("真够窝囊的，金衣楼的脸都被你丢光了！");
}
else
{
     	return ("你来消遣我？！");
}
}

int do_agree(string arg)
{
	if(this_player()->query_temp("killerside"))
	{
	message_vision("$N答道：在下愿意效劳。\n\n", this_player());
	command("say 得你之助，金衣楼终将一统江湖！");
	this_player()->set("killerside", "killer");
	this_player()->set("title",HIY"金衣杀手"NOR);
	this_player()->delete_temp("killerside");
	this_player()->save();
	}
	return 1;
}
int recognize_apprentice(object ob, object who)
{
	int i = (int)this_player()->query_skill("xuehejue", 1);
	int j = (int)this_player()->query_skill("force", 1);
	int k = (int)this_player()->query("daemon/xuehejue",1);
	if ( this_player()->query("killerside") != "killer")
		return notify_fail("你不是金衣楼旗下，难以领会血河诀的精髓。\n");
	if ( j < 300)
		return notify_fail("你的内功修为太低，强学这门功夫没用的，小心走火入魔。\n");
           if ( i >= 500)
		return notify_fail("你的血河诀已经到了很难在通过学习来进步了。\n");
	if ( i >= k)
		return notify_fail("你的实战能力不够，强学何用，只有在战斗中才能领悟更高深的武学。\n");

	return 1;
}
