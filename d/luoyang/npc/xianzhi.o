#include <ansi.h>
inherit NPC;

int ask_lianmeng();
int ask_finish1();
int ask_miemen();
int ask_finish2();
int ask_pozhen();
int goto_newworld();

void create()
{
set_name("先知", ({ "xian zhi", "xianzhi" }));
set("age", 1908+random(100));
set("title", "通天晓地");        
set("gender", "男性");
set("long",HIG"通天晓地，洞彻一切机密的先知，凡事你可以问问他。
你可以花一两黄金才向他祈祷（"+HIY"祈祷"+HIG"）知道自己的某些天赋。
你可以花十两黄金才请他召唤（"+HIY"召唤"+HIG"）丢失的法宝。\n");
set("attitude", "peaceful");
set("str", 20);
set("combat_exp", 20000);
set("max_kee", 400);
set("max_sen", 400);
set("max_force", 200);
set("force", 200);
set("force_factor", 10);
set_skill("unarmed", 40);
set_skill("dodge", 40);
set_skill("parry", 40);
set_skill("blade", 40);
set_skill("force", 40);
set("inquiry", ([
/*
        "破阵"          : (: ask_pozhen :),
        "联盟抗敌"      : (: ask_lianmeng :),
        "联盟奖励"      : (: ask_finish1 :),             
        "门派火拼"      : (: ask_miemen :),
        "灭门奖励"      : (: ask_finish2 :),             
*/        
        "我忘记了"      : HIG"\n如果你忘记了你的某些重要属性，可以向神"+HIY"祈祷"+HIG"！\n"NOR,              
        "我把它丢了"    : HIG"\n如果你把你的法宝弄丢了，你可以请求神"+HIY"召唤"+HIG"！\n"NOR,              
        "star"          : HIG"\n这是打开某些神秘入口的钥匙，如果你找回它们给我，神会祝福你！\n"NOR,              
        "stone"         : HIG"\n这是打开某些神秘入口的钥匙，如果你找回它们给我，神会祝福你！\n"NOR,             
        "jade"          : HIG"\n这是打开某些神秘入口的钥匙，如果你找回它们给我，神会祝福你！\n"NOR,              
]));
setup();
}
/*
void init ()
{
add_action("do_bless", "祈祷");
add_action("do_recall", "召唤");
}
*/
int do_bless(string arg)
{
object me=this_player();
string type;
if ( !arg )
        return notify_fail(HIG"你可以用"+HIY"祈祷 kar"+HIG"来祈祷知道福缘。
你可以用"+HIY"祈祷 per"+HIG"来祈祷知道容貌。
你可以用"+HIY"祈祷 life"+HIG"来祈祷知道阳寿。\n"NOR);

if ( !me->check_balance(10000) )
        return notify_fail("你的存款不足1 GOLD！\n");
sscanf(arg,"%s",type);
switch(type)
        {
        //福缘
        case "kar":
                me->balance_add(-10000);
                tell_object(me, HIY"你诚心向先知祈祷，先知提示你：\n"+HIC"你的福缘为 "HIG+me->query("kar")+"\n"NOR);
                break;
        //容貌
        case "per":
                me->balance_add(-10000);
                tell_object(me, HIY"你诚心向先知祈祷，先知提示你：\n"+HIC"你的容貌为 "HIG+me->query("per")+"\n"NOR);
                break;
        //阳寿
        case "life":
                me->balance_add(-10000);
                tell_object(me, HIY"你诚心向先知祈祷，先知提示你：\n"+HIC"你的阳寿为 "HIG+me->query("life/life_time")+"\n"NOR);
                break;
        default :
                return notify_fail(HIG"你可以用"+HIY"祈祷 kar"+HIG"来祈祷知道福缘。
你可以用"+HIY"祈祷 per"+HIG"来祈祷知道容貌。
你可以用"+HIY"祈祷 life"+HIG"来祈祷知道阳寿。\n"NOR);
        }
return 1;       
}

int do_recall(string arg)
{
int i;
object *inv;
object me=this_player();

if ( !arg || arg!= "法宝" )
        return notify_fail(HIG"你只可以用"+HIY"召唤 法宝"+HIG"来召唤你的法宝。\n"NOR);
if ( !userp(me) )
        return notify_fail(HIR"只有造有法宝的玩家可以召唤法宝。\n"NOR);
if ( !me->check_balance(100000) )
        return notify_fail(HIR"你的存款不足10 GOLD！\n"NOR);
if ( me->query("combat_exp")<500000 )
        return notify_fail(HIR"你的经验没有达到500000点，很难召唤法宝！\n"NOR);
if ( time()-(int)me->query("last_recall_fabao")<1800 )
        return notify_fail(HIR"你召唤法宝不能这么频繁！\n"NOR);
inv = all_inventory(me);
for(i=0; i<sizeof(inv); i++)
        {
        if ( (inv[i]->query("owner_id"))==me->query("id") ) 
                return notify_fail(HIR"你身上带有法宝，先知无法召唤！\n"NOR);
        }
me->balance_add(-100000);
me->set("last_recall_fabao", time());
me->setup();    
tell_object(me, HIY"你诚心祈求先知唤回你的法宝。\n"+HIY"召唤法宝成功！\n"NOR);
return 1;
}

int ask_lianmeng()
{
int i;
object *inv;
object who=this_player();
object ob=this_object();

if ( who->query("lianmeng/askd")!=1 )
        {
        message_vision(HIW"$N对$n说道：你先去找到接待使者问问敌人的状况。\n"NOR,this_object(),who);
        return 1;
        }
inv = all_inventory(who);
for(i=0; i<sizeof(inv); i++)
        {
        if ( (inv[i]->query("id"))!= "jinchuang yao" 
          && (inv[i]->query("id"))!= "hunyuan dan" 
          && (inv[i]->query("lianmeng"))!= 1 
          && (inv[i]->query("newbie"))!= 1 
          && (inv[i]->query("fz_get"))!= 1 
          && (inv[i]->query("10jue_get"))!= 1 
          && inv[i]->query("owner_id")!= who->query("id") 
          && (!inv[i]->query("money_id")) )
                {
                message_vision(CYN"$N对$n说道：你身上带些必要物品就行了，这是上战场哦。\n"NOR,this_object(),who);
                return 1;
                }
        }
message_vision(CYN"$N对$n说道：去准备准备吧，记得补药不够赶快出来买。\n"NOR,this_object(),who);
message_vision(HIY"\n\n$N对$n说道：勇士们，上路吧，祝你们好运！\n"NOR,this_object(),who);
who->move("/d/lianmeng/job/entrance");
return 1;
}

int ask_finish1()
{ 
object ob,me;
int i,lmgain,dx_r,exp_r,qn_r,num;
 
me = this_player();
        
if ( !me->query("lianmeng/gain") )
        {
        message_vision(CYN"\n你参与联盟抗敌了吗？\n"NOR,me);
        return 1;
        }
num = me->query("lianmeng/num")-1;
lmgain = me->query("lianmeng/gain");

exp_r=lmgain;
dx_r=lmgain/2;
qn_r=lmgain/3;

me->delete("lianmeng/askd");
me->delete("lianmeng/gain");

me->add("combat_exp",exp_r);
me->add("daoxing",dx_r);
me->add("potential",qn_r);
me->set("lianmeng/num",1);
message_vision(CYN"\n真的勇士，干的不错。\n"NOR,me);
tell_object(me, HIY"\n你成功完成联盟使命。"+HIY"\n你得到了"+COMBAT_D->chinese_daoxing(dx_r)+"道行和"+chinese_number(exp_r)+HIY"点实战经验和"+chinese_number(qn_r)+"点潜能！\n"NOR);

message("channel:xyj",HIG"\n【小雨西游】"+HIG"先知："+me->query("name")+"在联盟战场剿灭来犯的敌人"+chinese_number(num)+"名。\n"NOR,users()); 
message("channel:xyj",HIG"\n【小雨西游】"+HIG"先知："+me->query("name")+"参与联盟战斗！得到了"+COMBAT_D->chinese_daoxing(dx_r)+"道行和"+chinese_number(exp_r)+"点实战经验和"+chinese_number(qn_r)+"点潜能\n"NOR,users()); 
return 1;
}

int ask_miemen()
{
int i;
object room, *inv;
object who = this_player();
object ob = this_object();
if (!( room = find_object("/d/miemen/job/entrance")) )
        room = load_object("/d/miemen/job/entrance");
if ( who->query("combat_exp")<5000000 )
        {
        message_vision(HIW"$N对$n说道：你最好还是先去完成自己的修炼。\n"NOR,this_object(),who);
        return 1;
        }
if ((who->query("family/family_name")) != room->query("miemen/family11") && (who->query("family/family_name") != room->query("miemen/family21")))
        {
        message_vision(HIW"$N对$n说道：这次战斗不关你的事吧。\n"NOR,this_object(),who);
        return 1;
        }
inv = all_inventory(who);
for(i=0; i<sizeof(inv); i++)
        {
        if (
        (string)(inv[i]->query("id")) != "jinchuang yao" 
        && (string)(inv[i]->query("id")) != "hunyuan dan" 
        && (inv[i]->query("lianmeng")) != 1 
        && (inv[i]->query("newbie")) != 1 
        && (inv[i]->query("fz_get")) != 1 
        && (inv[i]->query("10jue_get")) != 1 
        && (inv[i]->query("owner_id")) != who->query("id") 
        && (!inv[i]->query("money_id"))
        )
                {
                message_vision(CYN"$N对$n说道：你身上带些必要物品就行了，这是去战斗哦。\n"NOR,this_object(),who);
                return 1;
                }
        }
message_vision(HIG"\n\n$N对$n说道：去吧！\n"NOR,this_object(),who);
who->move("/d/miemen/job/entrance");
return 1;
}

int ask_finish2()
{ 
object ob,me;
int i,mmgain,dx_r,exp_r,qn_r,num;
me=this_player();
        
if( !me->query("miemen/miemengain"))
        {
        message_vision(CYN"\n你参与门派战了吗？\n"NOR,me);
        return 1;
        }
num=(int)me->query("miemen/num")-1;
mmgain=(int)me->query("miemen/miemengain");
exp_r=mmgain;
dx_r=mmgain/2;
qn_r=mmgain/3;
me->delete("miemen/miemengain");
me->delete("miemen/finish");
me->add("combat_exp",exp_r);
me->add("daoxing",dx_r);
me->add("potential",qn_r);
me->set("miemen/num",1);
tell_object(me, HIY"\n你成功完成联盟使命。"+HIY"\n你得到了"+COMBAT_D->chinese_daoxing(dx_r)+"道行和"+chinese_number(exp_r)+HIY"点实战经验和"+chinese_number(qn_r)+"点潜能！\n"NOR);

message("channel:xyj",HIG"\n【门派火拼】"+HIG" "+me->query("name")+"在门派战场杀敌"+chinese_number(num)+"名。\n"NOR,users()); 
message("channel:xyj",HIG"\n【门派火拼】"+HIG" "+me->query("name")+"参与门派战斗！得到了"+COMBAT_D->chinese_daoxing(dx_r)+"道行和"+chinese_number(exp_r)+"点实战经验和"+chinese_number(qn_r)+"点潜能\n"NOR,users()); 
return 1;
}

int ask_pozhen()
{ 
object me=this_player();
        
if( me->query("combat_exp") < 100000)
        {
        message_vision(HIR"\n你武学不足100000点，还是别去给里面的怪物送菜了。\n"NOR,me);
        return 1;
        }
me->move("/d/pozhen/entrance");
return 1;
}

int goto_newworld()
{
int i;
object item;
object me = this_player();
command("say 新大陆是近日东海海上突然出现的一块陆地，已经有先行者前往开拓了。
你要去我便送你去吧,回来自己fly吧，我送你5张建房许可证,加油干吧~");
for( i=0; i<5; i++ )
        {
        item = new("/u/kakasi/newworld/deed");
        item->move(me);
        }
command("give deed to " + me->query("id") );
message_vision("$N突然消失在一阵光影中...\n",me);
me->move("/u/kakasi/newworld/city/1000_1000");
message_vision("忽然出现一阵强光,$N从里面掉了下来.\n",me);
return 1;
}

